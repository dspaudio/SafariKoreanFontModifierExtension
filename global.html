<!DOCTYPE HTML>
<html>

<head>
<script>
    safari.application.addEventListener('message', function(event) {
        if (event.name == 'getMatchedHost') {
            var host = event.message;
            var includes = safari.extension.settings.includes;
            var includeHosts = (includes == undefined || includes == null) ? [] : includes.split(' ');
            for (var i in includeHosts) {
                if (host.indexOf(includeHosts[i]) >= 0) {
                    event.target.page.dispatchMessage('returnMatchedHost', includeHosts[i]);
                    return;
                }
            }
            safari.extension.removeContentStyleSheet(safari.extension.baseURI + 'force.css');
        } else if (event.name == 'forceDefaultFont') {
            var host = event.message;
            var excludes = safari.extension.settings.excludes;
            var excludeHosts = (excludes == undefined || excludes == null) ? [] : excludes.split(' ');
            for (var i in excludeHosts) {
                if (host.indexOf(excludeHosts[i]) >= 0) {
                    return;
                }
            }

            host = (host.indexOf('.') != 0) ? '*.' + host : '*' + host;
            host = (host.charAt(host.length - 1) == '/') ? host + '*' : host + '/*';

            safari.extension.addContentStyleSheetFromURL(safari.extension.baseURI + 'force.css', ['http://' + host, 'https://' + host]);
        }
    }, true);
</script>
</head>

<body>
</body>

</html>
